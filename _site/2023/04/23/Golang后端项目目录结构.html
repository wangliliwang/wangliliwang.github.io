<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Golang后端项目目录结构</title><!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Golang后端项目目录结构" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="适用范围 适用范围：后端Golang项目。" />
<meta property="og:description" content="适用范围 适用范围：后端Golang项目。" />
<link rel="canonical" href="http://localhost:4000/2023/04/23/Golang%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.html" />
<meta property="og:url" content="http://localhost:4000/2023/04/23/Golang%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.html" />
<meta property="og:site_name" content="Wangli’s Programming Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-04-23T21:11:49+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Golang后端项目目录结构" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-04-23T21:11:49+08:00","datePublished":"2023-04-23T21:11:49+08:00","description":"适用范围 适用范围：后端Golang项目。","headline":"Golang后端项目目录结构","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2023/04/23/Golang%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.html"},"url":"http://localhost:4000/2023/04/23/Golang%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.html"}</script>
<!-- End Jekyll SEO tag -->
<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Wangli&apos;s Programming Blog" /><link rel="shortcut icon" type="image/x-icon" href="" />
  <link rel="stylesheet" href="/assets/css/main.css" />
</head><body a="auto">
    <main class="page-content" aria-label="Content">
      <div class="w">
        <a href="/">..</a><article>
    <p class="post-meta">
        <time datetime="2023-04-23 21:11:49 +0800">2023-04-23</time>
    </p>

    <h1>Golang后端项目目录结构</h1>

    <h2>Table Of Contents</h2>

    <div id="table-of-contents">
        <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#适用范围">适用范围</a></li>
<li class="toc-entry toc-h2"><a href="#目录结构">目录结构</a>
<ul>
<li class="toc-entry toc-h3"><a href="#cmd">cmd/</a></li>
<li class="toc-entry toc-h3"><a href="#bin">bin/</a></li>
<li class="toc-entry toc-h3"><a href="#internal">internal/</a>
<ul>
<li class="toc-entry toc-h4"><a href="#代码分层">代码分层</a></li>
<li class="toc-entry toc-h4"><a href="#access-接入层">access/ 接入层</a></li>
<li class="toc-entry toc-h4"><a href="#biz-服务层">biz/ 服务层</a></li>
<li class="toc-entry toc-h4"><a href="#data-数据层">data/ 数据层</a></li>
<li class="toc-entry toc-h4"><a href="#conf-配置解析">conf/ 配置解析</a></li>
<li class="toc-entry toc-h4"><a href="#consts-常量">consts/ 常量</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#pkg">pkg/</a></li>
<li class="toc-entry toc-h3"><a href="#resource">resource/</a>
<ul>
<li class="toc-entry toc-h4"><a href="#config">config/</a></li>
<li class="toc-entry toc-h4"><a href="#test">test/</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#scripts">scripts/</a></li>
<li class="toc-entry toc-h3"><a href="#makefile">Makefile</a></li>
<li class="toc-entry toc-h3"><a href="#其他-dockerfilegolangciymlreadmemdgitignore">其他 Dockerfile,.golangci.yml,README.md,.gitignore</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#参考">参考</a></li>
</ul>
    </div>

    <div id="markdown-content">
        <h2 id="适用范围">
<a class="anchor" href="#%E9%80%82%E7%94%A8%E8%8C%83%E5%9B%B4" aria-hidden="true"><span class="octicon octicon-link"></span></a>适用范围</h2>
<p>适用范围：后端Golang项目。</p>

<h2 id="目录结构">
<a class="anchor" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84" aria-hidden="true"><span class="octicon octicon-link"></span></a>目录结构</h2>

<p>规范：</p>
<ol>
  <li>一套代码可对应多个应用。</li>
  <li>一套代码会构建出来一个可执行文件，通过参数区分不同的应用，以节约docker仓库空间。</li>
  <li>目录结构及说明详述如下：</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
├── Dockerfile
├── Makefile             // 常用命令聚合
├── README.md
├── bin                  // 构建结果，被.gitignore忽略，不会提交到代码仓库
├── cmd                  // 项目服务入口
├── go.mod
├── go.sum
├── internal             // 此目录下代码不能被其他项目导入
│   ├── access              // 接入层
│   │   ├── api                // 接入层 - Web API接入逻辑
│   │   └── rpc                // 接入层 - RPC接入逻辑
│   ├── biz                 // 服务层
│   │   ├── aggr               // 服务聚合层
│   │   └── service            // 服务核心层
│   ├── conf                // 配置文件模型、解析逻辑
│   └── data                // 数据层
│       ├── dao                // 对db、cache的读取
│       └── rpcrequest         // 对外部rpc的读取
├── pkg                  // 此目录下代码可以被其他项目导入
├── resource             // 资源
│   ├── config              // 配置文件
│   └── test                // 测试资源
└── scripts              // 支撑性服务
</code></pre></div></div>

<h3 id="cmd">
<a class="anchor" href="#cmd" aria-hidden="true"><span class="octicon octicon-link"></span></a>cmd/</h3>

<p>规范：</p>
<ol>
  <li>此目录为项目服务入口，负责程序的启动、关闭、配置初始化等。</li>
  <li>cmd/main.go 负责加载配置文件，启动pprof，以及db、cache等初始化操作。</li>
  <li>cmd的每个子目录，对应一个接入层应用，这里不放置太多复杂的逻辑，只作为项目启动的入口。</li>
</ol>

<h3 id="bin">
<a class="anchor" href="#bin" aria-hidden="true"><span class="octicon octicon-link"></span></a>bin/</h3>

<p>规范：</p>
<ol>
  <li>此目录放置构建产物，被.gitignore忽略，不会提交到代码仓库</li>
</ol>

<h3 id="internal">
<a class="anchor" href="#internal" aria-hidden="true"><span class="octicon octicon-link"></span></a>internal/</h3>

<p>规范：</p>
<ol>
  <li>此目录放置项目的核心逻辑代码</li>
  <li>不希望被别的项目导入的代码，放在此目录</li>
</ol>

<h4 id="代码分层">
<a class="anchor" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E5%B1%82" aria-hidden="true"><span class="octicon octicon-link"></span></a>代码分层</h4>

<p>规范：</p>
<ol>
  <li>代码分为三层：
a. 接入层：作为服务提供方，与其他系统交互的渠道，这一层应尽量简单，不放入太复杂的逻辑。
b. 服务层：表达业务概念、业务状态信息、业务规则，分为服务核心层和服务聚合层。服务核心层是比较稳定的服务模块，服务聚合层聚合了多个服务核心模块的逻辑。
c. 数据层：获取外部数据</li>
  <li>层级调用规则：
a. 上层可以调用下层，下层不可以调用上层
b. 不能跨层调用（例外：接入层可以跨过服务聚合层，调用服务核心层的逻辑）
c. 不能同层调用（例外：服务聚合层可以调用服务核心层的逻辑，服务聚合层之间也可以相互调用）</li>
</ol>

<p><img src="/assets/20230423-golang/arch.png" alt=""></p>

<h4 id="access-接入层">
<a class="anchor" href="#access-%E6%8E%A5%E5%85%A5%E5%B1%82" aria-hidden="true"><span class="octicon octicon-link"></span></a>access/ 接入层</h4>

<p>规范：</p>
<ol>
  <li>负责维护参数解析、参数校验、组装响应、实例化服务实例等逻辑</li>
  <li>每个接入层服务使用一个单独的子文件夹</li>
</ol>

<h4 id="biz-服务层">
<a class="anchor" href="#biz-%E6%9C%8D%E5%8A%A1%E5%B1%82" aria-hidden="true"><span class="octicon octicon-link"></span></a>biz/ 服务层</h4>

<p>规范：</p>
<ol>
  <li>服务核心层（service/）是比较固定的服务模块</li>
  <li>服务聚合层（aggr/）维护服务核心层不同模块的融合逻辑</li>
  <li>使用interface实现依赖倒置</li>
  <li>每个服务模块，需要维护如下文件：
a. [domain].go，维护服务层模型和接口。接口的命名规则：“[domain]Service”
b. impl/ 接口的实现及单元测试，包括具体实现，和工厂函数。实现的命名规则：“[domain]ServiceImpl”
c. mock/ 接口的mock实现，gomock根据接口定义自动生成代码，包括具体实现，和工厂函数</li>
</ol>

<h4 id="data-数据层">
<a class="anchor" href="#data-%E6%95%B0%E6%8D%AE%E5%B1%82" aria-hidden="true"><span class="octicon octicon-link"></span></a>data/ 数据层</h4>

<p>规范：</p>
<ol>
  <li>对db、cache的读取逻辑应放入dao/中；</li>
  <li>对其他外部数据源的调用，都放入意义明确的目录下，例如：对外部项目rpc的调用放在rpcrequest/目录下</li>
  <li>各模块都需要使用interface实现“依赖倒置”</li>
</ol>

<p>account.go示例如下（包括interface、物理模型）：</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">AccountInfo</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">Name</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">AccountDAO</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="n">GetAccountInfo</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">id</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">AccountInfo</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>impl/account.go示例如下：</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">accountImpl</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">mysqlPool</span> <span class="o">*</span><span class="n">gorm</span><span class="o">.</span><span class="n">DB</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span><span class="n">accountImpl</span><span class="p">)</span> <span class="n">GetAccountInfo</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">id</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">dao</span><span class="o">.</span><span class="n">AccountInfo</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">panic</span><span class="p">(</span><span class="s">"impl me"</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">NewAccountDAO</span><span class="p">()</span> <span class="n">dao</span><span class="o">.</span><span class="n">AccountDAO</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="n">accountImpl</span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="conf-配置解析">
<a class="anchor" href="#conf-%E9%85%8D%E7%BD%AE%E8%A7%A3%E6%9E%90" aria-hidden="true"><span class="octicon octicon-link"></span></a>conf/ 配置解析</h4>

<p>规范：</p>
<ol>
  <li>维护配置模型、配置初始化逻辑</li>
</ol>

<h4 id="consts-常量">
<a class="anchor" href="#consts-%E5%B8%B8%E9%87%8F" aria-hidden="true"><span class="octicon octicon-link"></span></a>consts/ 常量</h4>

<p>规范：</p>
<ol>
  <li>维护常量</li>
</ol>

<h3 id="pkg">
<a class="anchor" href="#pkg" aria-hidden="true"><span class="octicon octicon-link"></span></a>pkg/</h3>

<p>规范：</p>
<ol>
  <li>可以在其他项目中导入的代码，应放在这个目录中。</li>
  <li>内部子目录规范同 internal/ 。</li>
</ol>

<h3 id="resource">
<a class="anchor" href="#resource" aria-hidden="true"><span class="octicon octicon-link"></span></a>resource/</h3>

<p>规范：</p>
<ol>
  <li>维护项目依赖的资源文件</li>
</ol>

<h4 id="config">
<a class="anchor" href="#config" aria-hidden="true"><span class="octicon octicon-link"></span></a>config/</h4>
<p>规范：</p>
<ol>
  <li>维护项目配置文件</li>
  <li>对于每一个代码运行环境（如本地环境、开发环境、测试环境、生产环境等）都应该设置一个单独的配置文件。</li>
</ol>

<h4 id="test">
<a class="anchor" href="#test" aria-hidden="true"><span class="octicon octicon-link"></span></a>test/</h4>

<p>规范：</p>
<ol>
  <li>维护测试数据</li>
</ol>

<h3 id="scripts">
<a class="anchor" href="#scripts" aria-hidden="true"><span class="octicon octicon-link"></span></a>scripts/</h3>

<p>规范：</p>
<ol>
  <li>维护项目补充性脚本</li>
</ol>

<h3 id="makefile">
<a class="anchor" href="#makefile" aria-hidden="true"><span class="octicon octicon-link"></span></a>Makefile</h3>

<p>规范：</p>
<ol>
  <li>维护常用命令，比如构建可执行文件、运行lint、运行mock等，示例如下：</li>
</ol>

<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">.PHONY</span><span class="o">:</span> <span class="nf">all lint fix test mock-fetch mock</span>

<span class="nl">all</span><span class="o">:</span>
    <span class="err">go</span> <span class="err">build</span> <span class="err">-o</span> <span class="err">bin/main</span> <span class="err">cmd/main.go</span>

<span class="nl">lint</span><span class="o">:</span>
    <span class="err">golangci-lint</span> <span class="err">run</span> <span class="err">./cmd/...</span>
    <span class="err">golangci-lint</span> <span class="err">run</span> <span class="err">./pkg/...</span>

<span class="nl">fix</span><span class="o">:</span>
    <span class="err">golangci-lint</span> <span class="err">run</span> <span class="err">--fix</span> <span class="err">./cmd/...</span>
    <span class="err">golangci-lint</span> <span class="err">run</span> <span class="err">--fix</span> <span class="err">./internal/...</span>

<span class="nl">test</span><span class="o">:</span>
    <span class="err">go</span> <span class="err">test</span> <span class="err">-v</span> <span class="nv">-coverprofile</span><span class="o">=</span>coverage.out ./internal/...

<span class="nl">mock-fetch</span><span class="o">:</span>
    <span class="err">go</span> <span class="err">get</span> <span class="err">github.com/golang/mock/gomock</span>
    <span class="err">go</span> <span class="err">get</span> <span class="err">github.com/golang/mock/mockgen</span>

<span class="nl">mock</span><span class="o">:</span> <span class="nf">mock-fetch</span>
    <span class="err">mkdir</span> <span class="err">-p</span> <span class="err">internal/biz/service/mock</span>
    <span class="err">mkdir</span> <span class="err">-p</span> <span class="err">internal/data/dao/mock</span>
    <span class="err">mockgen</span> <span class="nv">-source</span><span class="o">=</span>internal/biz/service/account.go <span class="nt">-package</span><span class="o">=</span>mock <span class="nt">-destination</span><span class="o">=</span>internal/biz/service/mock/account.go
</code></pre></div></div>

<h3 id="其他-dockerfilegolangciymlreadmemdgitignore">
<a class="anchor" href="#%E5%85%B6%E4%BB%96-dockerfilegolangciymlreadmemdgitignore" aria-hidden="true"><span class="octicon octicon-link"></span></a>其他 Dockerfile,.golangci.yml,README.md,.gitignore</h3>

<p>规范：</p>
<ol>
  <li>其他项目文件按照实际作用命名</li>
</ol>

<h2 id="参考">
<a class="anchor" href="#%E5%8F%82%E8%80%83" aria-hidden="true"><span class="octicon octicon-link"></span></a>参考</h2>

<ol>
  <li><a href="https://github.com/golang-standards/project-layout">project-layout</a></li>
  <li><a href="https://cloud.tencent.com/developer/article/1953855">Golang微服务简洁架构实战</a></li>
  <li><a href="https://blog.csdn.net/significantfrank/article/details/110934799">应用架构的最佳实践</a></li>
</ol>

    </div>

</article>
      </div>
    </main>
  </body>
</html>